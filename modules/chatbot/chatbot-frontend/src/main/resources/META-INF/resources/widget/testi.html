<!DOCTYPE html>
<html>
    <head>
      <base href="./">
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="application/javascript">
              var startFromHome = true
              var messages = localStorage.getItem("tiledesk_widget_sv1_bot_conversation_messages");
              if (messages){
                startFromHome = false
              }

              window.tiledeskSettings = 
              {
                  projectid: "bot_conversation",
                  persistence:"local",                /** local/session/none **/
                  userId: "dario_test_user_id",
                  isLogEnabled: true,                     /** true/false **/
                  logoChat:"https://user-images.githubusercontent.com/9556761/64188450-bf255800-ce72-11e9-9485-20b31f626048.png",                  /** none/tiledesklogo/absolute url **/
                  welcomeTitle:"Servizio assistenza Città Metropolitana di Bari",            /** string **/
                  welcomeMsg: " ",                /** string **/
                  allowTranscriptDownload: false,
                  widgetTitle: "Bari",
                  poweredBy: "",
                  showLogoutOption: false, 
                  marginX: '20px',
                  marginY: '20px',
                  calloutTimer: -1,
                  startFromHome: startFromHome,
                  // customAttributes: '{"url_audiorepo": "http://localhost:3000", "proxy_url": "https://baribot.herokuapp.com/proxy", "agent": "chatbot-253907", "recipient": "bari_bot", "recipient_fullname": "Hal 9000", "button_label": "Chiedi a Ernesto", "immagine_benvenuto": "https://user-images.githubusercontent.com/9556761/64190907-aec3ac00-ce77-11e9-8ce7-8935e43d15cb.png", "messaggio_benvenuto": "Ciao, mi chiamo Ernesto e sono il tuo assistente virtuale sul sito della Città Metropolitana di Bari. Per richiedere il mio aiuto premi il pulsante \'Chiedi a Ernesto\'"}',
                  customAttributes: {
                    url_audiorepo: "http://localhost:3000", //"https://egov2-dev.comune.bari.it/node",
                    proxy_url: "https://baribot.herokuapp.com/proxy", 
                    agent: "supporto-anagrafe-vcqvkb", 
                    recipient: "supporto-anagrafe-vcqvkb", 
                    recipient_fullname: "Hal 9000", 
                    button_label: "Ask the bot", 
                    welcome_image: "https://user-images.githubusercontent.com/9556761/64190907-aec3ac00-ce77-11e9-8ce7-8935e43d15cb.png", 
                    welcome_summary: "Hello, I'm your Virtual Assistant, powered by Dialogflow. To get help push \'Ask the bot\'",
                    start_hidden_message: "__start",
                    payload: {
                      codiceFiscale: "SPNNDR", 
                      firstname: "Andrea",
                      lastname: "Sponziello"
                    }
                  },
                  hideAttachButton: true, // nasconde il pulsante allegati 
                  showMicButton: true, // mostra il pulsante microfono
                  showResetConversation: true,

                  
              };
              (function(d, s, id) {
                
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); 
                js.id = id;
                js.src = "./launch.js";
                fjs.parentNode.insertBefore(js, fjs);
              }(document, 'script', 'tiledesk-jssdk'));
              
              window.tileDeskAsyncInit = function() {
                window.tiledesk.on('getImageUrlThumb', function(event_data) {
                  var message =  event_data.detail.message;
                  if(message.sender === 'bari_bot'){
                    message.sender_urlImage = "https://user-images.githubusercontent.com/9556761/64333473-de3cfa80-cfd6-11e9-971b-c00c41dd2f91.png";
                  }
                });

                window.tiledesk.on('loadParams', function(event_data) {
                  // alert("showCallout")
                  setTimeout(function() {
                    window.tiledesk.showCallout()
                  }, 3000)
                });

              };
            </script>
    </head>
    <body>
        Widget Test Comune di Bari.
    </body>
</html>